<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gewichteter Notenrechner</title>
</head>
<body>

  <h1>Gewichteter Notenrechner</h1>

  <label for="fachAuswahl">Fach auswählen:</label>
  <select id="fachAuswahl">
    <option value="Mathematik">Mathematik</option>
    <option value="Deutsch">Deutsch</option>
    <option value="Französisch">Französisch</option>
    <option value="Englisch">Englisch</option>
    <option value="Sport">Sport</option>
  </select>

  <label for="erwarteteNote">Erwartete Note:</label>
  <input type="number" step="0.1" id="erwarteteNote" placeholder="Erwartete Note">

  <label for="gewichtungErwarteteNote">Gewichtung der erwarteten Note:</label>
  <input type="number" step="0.1" id="gewichtungErwarteteNote" placeholder="Gewichtung der erwarteten Note">

  <label for="gewuenschterSchnitt">Gewünschter Schnitt:</label>
  <input type="number" step="0.1" id="gewuenschterSchnitt" placeholder="Gewünschter Schnitt">

  <h2>Notenliste:</h2>
  <ul id="notenListe"></ul>

  <h2>Gewichteter Durchschnitt:</h2>
  <p id="durchschnitt">-</p>

  <h2>Beschreibungen und Daten der Prüfungen:</h2>
  <ul id="pruefungsDetails"></ul>

  <h2>Erforderliche Note für gewünschten Schnitt:</h2>
  <p id="erforderlicheNote">-</p>

  <script>
    // Initialisierung
    const fachAuswahl = document.getElementById('fachAuswahl');
    const erwarteteNoteInput = document.getElementById('erwarteteNote');
    const gewichtungErwarteteNoteInput = document.getElementById('gewichtungErwarteteNote');
    const gewuenschterSchnittInput = document.getElementById('gewuenschterSchnitt');
    const notenListeElement = document.getElementById('notenListe');
    const durchschnittElement = document.getElementById('durchschnitt');
    const pruefungsDetailsElement = document.getElementById('pruefungsDetails');
    const erforderlicheNoteElement = document.getElementById('erforderlicheNote');
    let jsonData = null;

    // Laden der JSON-Daten für Noten
    async function loadJsonData() {
      try {
        const response = await fetch('noten.json'); // Passe den Dateinamen an
        jsonData = await response.json();
      } catch (error) {
        console.error('Fehler beim Laden der JSON-Daten:', error);
      }
    }

    // Event-Handler für Fachauswahl, erwartete Note, Gewichtung der erwarteten Note und gewünschten Schnitt
    fachAuswahl.addEventListener('change', updateFach);
    erwarteteNoteInput.addEventListener('input', updateFach);
    gewichtungErwarteteNoteInput.addEventListener('input', updateFach);
    gewuenschterSchnittInput.addEventListener('input', updateFach);

    // Initialisierung mit Laden der JSON-Daten
    loadJsonData().then(() => {
      // Initialisierung mit erstem Fach
      updateFach();
    });

    // Funktion zum Aktualisieren der Anzeige basierend auf der Fachauswahl
    function updateFach() {
      const selectedFach = fachAuswahl.value;
      const erwarteteNote = parseFloat(erwarteteNoteInput.value) || 0;
      const gewichtungErwarteteNote = parseFloat(gewichtungErwarteteNoteInput.value) || 0;
      const gewuenschterSchnitt = parseFloat(gewuenschterSchnittInput.value) || 0;

      if (jsonData && jsonData.schulfächer) {
        // Suchen nach dem ausgewählten Fach in den JSON-Daten
        const fachData = jsonData.schulfächer.find(fach => fach.fach === selectedFach);

        if (fachData) {
          // Notenliste aktualisieren
          updateNotenListe(fachData.noten, fachData.gewichtung);

          // Gewichteter Durchschnitt aktualisieren
          updateGewichteterDurchschnitt(fachData.noten, fachData.gewichtung, erwarteteNote, gewichtungErwarteteNote);

          // Beschreibungen und Daten der Prüfungen aktualisieren
          updatePruefungsDetails(fachData.beschreibungen, fachData.datum);

          // Erforderliche Note für gewünschten Schnitt aktualisieren
          updateErforderlicheNote(fachData.noten, fachData.gewichtung, gewuenschterSchnitt);
        } else {
          alert('Fach nicht gefunden.');
        }
      }
    }

    // Funktion zur Aktualisierung der Notenliste
    function updateNotenListe(noten, gewichtungen) {
      notenListeElement.innerHTML = '';

      for (let i = 0; i < noten.length; i++) {
        const listItem = document.createElement('li');
        listItem.textContent = `Note ${i + 1}: ${noten[i]} (Gewichtung: ${gewichtungen[i]})`;
        notenListeElement.appendChild(listItem);
      }
    }

    // Funktion zur Aktualisierung des gewichteten Durchschnitts
    function updateGewichteterDurchschnitt(noten, gewichtungen, erwarteteNote, gewichtungErwarteteNote) {
      if (noten.length > 0) {
        const summeProdukte = noten.reduce((a, b, index) => a + b * gewichtungen[index], 0);
        const summeGewichtungen = gewichtungen.reduce((a, b) => a + b, 0);
        const summeGewichtungenMitErwarteterNote = summeGewichtungen + gewichtungErwarteteNote;

        let gewichteterDurchschnitt;
        if (erwarteteNote !== 0 && gewichtungErwarteteNote !== 0) {
          gewichteterDurchschnitt = (summeProdukte + erwarteteNote * gewichtungErwarteteNote) / summeGewichtungenMitErwarteterNote;
        } else {
          gewichteterDurchschnitt = summeProdukte / summeGewichtungen;
        }

        durchschnittElement.textContent = `Gewichteter Durchschnitt: ${gewichteterDurchschnitt.toFixed(2)}`;
      } else {
        durchschnittElement.textContent = 'Gewichteter Durchschnitt: -';
      }
    }

    // Funktion zur Aktualisierung der Prüfungsdetails
    function updatePruefungsDetails(beschreibungen, daten) {
      pruefungsDetailsElement.innerHTML = '';

      for (let i = 0; i < beschreibungen.length; i++) {
        const listItem = document.createElement('li');
        listItem.textContent = `Prüfung ${i + 1}: Datum: ${daten[i]}, Beschreibung: ${beschreibungen[i]}`;
        pruefungsDetailsElement.appendChild(listItem);
      }
    }

// Funktion zur Aktualisierung der erforderlichen Note für gewünschten Schnitt
function updateErforderlicheNote(noten, gewichtungen, gewuenschterSchnitt) {
  if (noten.length > 0) {
    const summeGewichtungen = gewichtungen.reduce((a, b) => a + b, 0);
    const summeProdukte = noten.reduce((a, b, index) => a + b * gewichtungen[index], 0);

    let erforderlicheNote;

    if (summeGewichtungen > 0) {
      // Formel: gewuenschterSchnitt = (summeProdukte + erforderlicheNote) / (summeGewichtungen + 1)
      // Umgestellt für erforderlicheNote: erforderlicheNote = gewuenschterSchnitt * (summeGewichtungen + 1) - summeProdukte
      erforderlicheNote = gewuenschterSchnitt * (summeGewichtungen + 1) - summeProdukte;

      // Begrenze die erforderlicheNote auf den Bereich von 1 bis 6
      erforderlicheNote = Math.max(1, Math.min(6, erforderlicheNote));
    } else {
      // Wenn keine Gewichtungen vorhanden sind, setze die erforderlicheNote gleich dem gewünschten Schnitt
      erforderlicheNote = Math.max(1, Math.min(6, gewuenschterSchnitt));
    }

    // Überprüfe, ob die erforderlicheNote über 6 liegt und zeige eine entsprechende Nachricht
    if (erforderlicheNote > 6 || gewuenschterSchnitt > 6) {
      erforderlicheNoteElement.textContent = 'Dieser Schnitt ist nicht möglich (Note außerhalb des Bereichs 1-6).';
    } else {
      erforderlicheNoteElement.textContent = `Erforderliche Note für gewünschten Schnitt: ${erforderlicheNote.toFixed(2)}`;
    }
  } else {
    erforderlicheNoteElement.textContent = 'Erforderliche Note für gewünschten Schnitt: -';
  }
}


  </script>

</body>
</html>
